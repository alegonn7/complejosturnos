// Sistema de Gesti칩n de Turnos para Canchas
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// USUARIOS
enum RolUsuario {
  SUPERADMIN
  DUENO
  EMPLEADO
  CLIENTE
}

model Usuario {
  id        String     @id @default(cuid())
  email     String?    @unique
  telefono  String     @unique
  dni       String?    @unique
  nombre    String
  apellido  String
  rol       RolUsuario @default(CLIENTE)
  password  String?
  
  complejoId String?
  complejo   Complejo? @relation(fields: [complejoId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  complejosPropios Complejo[] @relation("ComplejosPropietario")
  turnos           Turno[]
  turnosFijos      TurnoFijo[]
  
  @@index([telefono])
  @@index([dni])
}

// COMPLEJOS
model Complejo {
  id          String   @id @default(cuid())
  nombre      String
  direccion   String
  telefono    String
  email       String?
  
  cbu         String?
  alias       String?
  titular     String?
  
  requiereSe침a       Boolean @default(true)
  porcentajeSe침a     Int     @default(50)
  minutosExpiracion  Int     @default(30)
  permiteTurnosFijos Boolean @default(true)
  
  numeroWhatsapp String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  propietarioId String?
  propietario   Usuario?  @relation("ComplejosPropietario", fields: [propietarioId], references: [id])
  
  empleados  Usuario[]
  canchas    Cancha[]
  deportes   Deporte[]
  turnos     Turno[]
}

// DEPORTES
model Deporte {
  id        String   @id @default(cuid())
  nombre    String
  icono     String?
  
  complejoId String
  complejo   Complejo @relation(fields: [complejoId], references: [id], onDelete: Cascade)
  
  canchas   Cancha[]
  
  @@unique([complejoId, nombre])
}

// CANCHAS
enum EstadoCancha {
  HABILITADA
  DESHABILITADA
  EN_MANTENIMIENTO
}

model Cancha {
  id          String       @id @default(cuid())
  nombre      String
  descripcion String?
  estado      EstadoCancha @default(HABILITADA)
  
  precioBase  Decimal @db.Decimal(10, 2)
  
  complejoId  String
  complejo    Complejo @relation(fields: [complejoId], references: [id], onDelete: Cascade)
  
  deporteId   String
  deporte     Deporte  @relation(fields: [deporteId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  configuracionHorarios ConfiguracionHorarioCancha[]
  preciosDinamicos      PrecioDinamico[]
  turnos                Turno[]
  turnosFijos           TurnoFijo[]
  
  @@unique([complejoId, nombre])
}

// CONFIGURACION DE HORARIOS
model ConfiguracionHorarioCancha {
  id              String   @id @default(cuid())
  diaSemana       Int
  horaInicio      String
  horaFin         String
  duracionTurno   Int
  activo          Boolean  @default(true)
  
  diasAdelante    Int      @default(30)
  ultimaGeneracion DateTime?
  
  canchaId        String
  cancha          Cancha   @relation(fields: [canchaId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([canchaId, diaSemana])
}

// PRECIOS DINAMICOS
model PrecioDinamico {
  id              String   @id @default(cuid())
  diaSemana       Int
  porcentaje      Int
  descripcion     String?
  
  canchaId        String
  cancha          Cancha   @relation(fields: [canchaId], references: [id], onDelete: Cascade)
  
  @@unique([canchaId, diaSemana])
}

// TURNOS
enum EstadoTurno {
  DISPONIBLE
  RESERVADO
  SENA_ENVIADA
  CONFIRMADO
  CANCELADO
  EXPIRADO
  AUSENTE
  BLOQUEADO
}

model Turno {
  id          String      @id @default(cuid())
  fecha       DateTime
  duracion    Int
  estado      EstadoTurno @default(DISPONIBLE)
  
  dni              String?
  nombreCliente    String?
  apellidoCliente  String?
  telefonoCliente  String?
  
  precioTotal      Decimal  @db.Decimal(10, 2)
  montoSe침a        Decimal? @db.Decimal(10, 2)
  
  fechaReserva      DateTime?
  fechaExpiracion   DateTime?
  fechaConfirmacion DateTime?
  
  canchaId    String
  cancha      Cancha   @relation(fields: [canchaId], references: [id])
  
  complejoId  String
  complejo    Complejo @relation(fields: [complejoId], references: [id])
  
  usuarioId   String?
  usuario     Usuario? @relation(fields: [usuarioId], references: [id])
  
  turnoFijoId String?
  turnoFijo   TurnoFijo? @relation(fields: [turnoFijoId], references: [id])
  
  pago        Pago?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([fecha, canchaId])
  @@index([estado])
  @@index([dni])
  @@index([telefonoCliente])
}

// PAGOS
enum MetodoPago {
  TRANSFERENCIA
  EFECTIVO
  MERCADOPAGO
  OTRO
}

enum EstadoPago {
  PENDIENTE
  ENVIADO
  APROBADO
  RECHAZADO
}

model Pago {
  id          String      @id @default(cuid())
  monto       Decimal     @db.Decimal(10, 2)
  metodo      MetodoPago  @default(TRANSFERENCIA)
  estado      EstadoPago  @default(PENDIENTE)
  
  fechaEnvio      DateTime?
  fechaValidacion DateTime?
  
  motivoRechazo   String?
  
  turnoId     String   @unique
  turno       Turno    @relation(fields: [turnoId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// TURNOS FIJOS
model TurnoFijo {
  id          String   @id @default(cuid())
  diaSemana   Int
  horaInicio  String
  duracion    Int
  
  activo      Boolean  @default(true)
  fechaInicio DateTime
  fechaFin    DateTime?
  
  usuarioId   String
  usuario     Usuario  @relation(fields: [usuarioId], references: [id])
  
  canchaId    String
  cancha      Cancha   @relation(fields: [canchaId], references: [id])
  
  turnosGenerados Turno[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([canchaId, diaSemana, horaInicio])
}